<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>邀请函2.0</title>
    <!--<meta id="viewPort" name="viewport"-->
    <!--content="width=320, initial-scale=1, maximum-scale=1, user-scalable=no" servergenerated="true"/>-->
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="../res/css/yq.css"/>

    <script src="../res/js/jquery-1.11.3.min.js"></script>
    <script src="../res/plugins/swiper-3.3.1/swiper.jquery.min.js"></script>

    <script src="../res/plugins/swiper-3.3.1/swiper.animate1.0.2.min.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=gSTmHrK8gvFvHe167KA5nEcTbUmlHfeF"></script>
    <!--<script type="text/javascript" src="http://api.map.baidu.com/getscript?type=quick&file=feature&ak=gSTmHrK8gvFvHe167KA5nEcTbUmlHfeF"></script>-->

    </head>
<body>
<div id="main" class="swiper-container">
    <div class="swiper-wrapper">
        <div id="slide1" class="swiper-slide">

            <div class="host">
                <span id="host">林先生</span>
                <span style="">邀请</span>
            </div>

            <div class="qin move"  effect="fadeIn" delay="0.6s">
                <span>亲</span>
            </div>

            <div class="pic location-pic1 move"  effect="fadeInDown"  delay="1.0s">
                <img src="../res/img/user_pic_1.JPG"/>
            </div>

            <div class="time move"  effect="bounceInUp" duration="2.0s" delay="1.3s">
                <span>16年1月1号中午有空么</span>
            </div>

            <div class="room move"  effect="bounceInUp" duration="2.0s" delay="2.0s">
                <span>我订了西贝西北菜-兴泰店202雅间</span>
            </div>

            <div class="pic location-pic2 move"  effect="fadeInUp" delay="2.5s">
                <img src="../res/img/user_pic_2.JPG"/>
            </div>

            <div class="xiangyue move"  effect="fadeIn" delay="3.5s">
                <span class="move"  effect="wobble" delay="4.0s">想约</span>
            </div>
            <div class="ni move"  effect="bounceInLeft" delay="3s">
                <span class="move"  effect="rubberBand" delay="4.5s">你</span>
            </div>
            <div class="yiqizuozuo move"  effect="fadeInRight" delay="3s">
                <span class="move"  effect="bounce" delay="4.5s">一起坐坐</span>
            </div>



        </div>
        <div id="slide2" class="swiper-slide">
            <div class="yellow-square move"  effect="zoomIn" delay="0.5s">
                <span>要认准饭店地址哦</span>
            </div>
            <div id="location"  class="location move" effect="fadeIn" delay="1.2s">
                地址：<br/><span>内蒙古饭店东巷塞上府东</span>
            </div>
            <div id="map" class="map" effect="bounceIn" duration="1.0s" delay="1.8s">

            </div>
        </div>
        <div id="slide3" class="swiper-slide">
            <div id="menu" class="swiper-container">
                <div class="swiper-wrapper">
                    <div id="menuSlide1" class="swiper-slide">
                        <div class="menu-top"><span>xxx饭店菜谱</span></div>
                        <div id="category" class="menu-left">
                            <ul>
                                <li class="selected">全部</li>
                                <li>东北菜</li>
                                <li>西北菜</li>
                                <li>咸菜</li>
                                <li>你好</li>
                            </ul>
                        </div>
                        <div id="foodListWrapper" class="menu-right">
                            <div id="foodList">
                                <li class="food-list-item">
                                    <ul name="food1" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num">2</span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">鱼香肉丝</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                    <ul name="food2" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num">5</span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">辣子肉丁</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                    <ul name="food3" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num">  </span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">小鸡炖蘑菇</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                    <ul name="food2" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num">  </span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">辣子肉丁</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                    <ul name="food3" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num"></span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">小鸡炖蘑菇</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                </li>
                                <li class="food-list-item">
                                    <ul name="food2" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num">  </span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">辣子肉丁</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                    <ul name="food3" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num">  </span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">小鸡炖蘑菇</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                    <ul name="food2" class="food-item">
                                        <li class="food-quantity"><span class="plus"></span><span class="num">  </span><span class="minus"></span></li>
                                        <li class="food-img"><img src="../res/img/yhdefault.jpg"/></li>
                                        <li class="food-name">辣子肉丁</li>
                                        <li class="food-price"><span>18</span>元</li>
                                        <li class="food-up">120人点过</li>
                                    </ul>
                                </li>
                            </div>
                        </div>
                        <div class="menu-bottom">
                            <li class="ordered">已选 <span id="totalQuantity" class="total-quantity"></span> 总价 <span id="totalPrice" class="total-price"></span></li>
                            <li class="ok-btn"><span id="OK">我点好了</span></li>
                        </div>
                    </div>
                    <div id="menuSlide2" class="swiper-slide">
                        <div class="menu-top"><span id="back" class="menu-back">返 回</span><span>购物车</span></div>
                        <div class="make-order"><span>请叫服务员下单：</span><span>共计</span><span id="detailPrice" class="total-price">50元</span></div>
                        <div id="orderDetailWrapper" class="order-detail">
                            <div id="orderDetails">
                                <div class="my-order"><span>我的订单</span><span id="goOn">继续点单</span><span id="clearAll">清空</span></div>
                                <div class="order-detail-name"><span>详细信息</span></div>
                                <div class="order-detail-list">
                                    <ul id="orderDetailList">
                                        <li><span class="food-name">水电费</span><span class="cancel"></span><span class="food-quantity">123.5元</span><span class="food-price">23份</span></li>
                                        <li><span class="food-name">水电费</span><span class="cancel"></span><span class="food-quantity">123.5元</span><span class="food-price">23份</span></li>
                                        <li><span class="food-name">水电费</span><span class="cancel"></span><span class="food-quantity">123.5元</span><span class="food-price">23份</span></li>
                                    </ul>
                                </div>
                                <div id="orderDetailForm" class="order-detail-form">
                                    <li><label>就餐日期</label>
                                        <select>
                                            <option selected value="1">1月1日</option>
                                            <option selected value="2">1月2日</option>
                                            <option selected value="3">1月3日</option>
                                            <option selected value="4">1月4日</option>
                                         </select>
                                    </li>
                                    <li><label>预定桌号</label>
                                        <select>
                                            <option selected value="1">1</option>
                                            <option selected value="2">2</option>
                                            <option selected value="3">3</option>
                                            <option selected value="4">4</option>
                                        </select>
                                    </li>
                                    <li><label>预定人数</label>
                                        <INPUT type="text" placeholder="如：12" value="" />
                                    </li>
                                    <li><label>就餐时间</label>
                                        <div class="time">
                                            <select>
                                            <option selected value="1" selected>时</option>
                                            <option  value="2">2</option>
                                            <option  value="3">3</option>
                                            <option  value="4">4</option>
                                            </select>
                                            <select>
                                                <option selected value="1" selected>分</option>
                                                <option  value="2">2</option>
                                                <option  value="3">3</option>
                                                <option  value="4">4</option>
                                            </select>
                                        </div>
                                    </li>
                                    <li><label>最晚就餐时间</label>
                                        <div class="time">
                                            <select>
                                                <option selected value="1" >时</option>
                                                <option  value="2">2</option>
                                                <option  value="3">3</option>
                                                <option  value="4">4</option>
                                            </select>
                                            <select>
                                                <option selected value="1" selected>分</option>
                                                <option  value="2">2</option>
                                                <option  value="3">3</option>
                                                <option  value="4">4</option>
                                            </select>
                                        </div>
                                    </li>

                                    <li><label>用户姓名</label>
                                        <INPUT type="tel" placeholder="如：王先生" value="" />
                                    </li>

                                    <li><label>联系电话</label>
                                        <INPUT type="text" placeholder="如：134332" value="" />
                                    </li>

                                    <li><label>调剂</label>
                                        <select>
                                            <option selected value="0">不服从调剂</option>
                                            <option selected value="1">服从调剂</option>
                                        </select>
                                    </li>

                                    <li><label>备注说明</label>
                                        <TEXTAREA name="rmrese.memo"  placeholder="忌口、发票抬头等"></TEXTAREA>
                                    </li>

                                    <li>
                                        <span id="orderSubmit" class="order-submit">确定提交</span>
                                    </li>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="slide4" class="swiper-slide">
            <div class="diantuan move" effect="zoomIn" delay="0.2s">
                <img src="../res/img/diantuan.png">
            </div>
            <div class="jingxinshenghuo move" effect="slideInLeft" delay="1s">
                <span>品 味 电 团 精 心 生 活</span>
            </div>
            <div class="line move" effect="zoomIn" delay="1.5s">
                <img src="../res/img/horizen_line.png">
            </div>
            <div class="fangxinjue move" effect="slideInRight" delay="1s">
                <span>喝 放 心 酒 选 九 联</span>
            </div>
            <div class="bendi move" effect="fadeInDownBig" delay="1.5s">
                <span>内蒙古本地020</span>
            </div>
            <div class="weixinguanzhu move" effect="fadeInUpBig" delay="2s">
                <span>微信关注“九联”米面油酒茶，20分钟送达</span>
            </div>
            <div class="hand move" effect="rotateInDownRight" delay="3s">
                <img src="../res/img/hand.png">
            </div>
            <div class="guahaocha move" effect="flipInX" delay="3s">
                <span>动动小手，刮好茶</span>
            </div>
        </div>



    </div>
    <!-- 如果需要分页器 -->
    <div class="swiper-pagination">
        <span id="progressCustom" class="progress"></span>
        <span class="fraction"><span id="currentFraction"></span>/<span id="totalFraction"></span></span>
    </div>
    <!--向上箭头-->
    <div class="up-arrow"></div>
    <!--音乐播放-->
    <div id="music" class="music rotating">
        <!--<audio loop="loops" src="../res/audio/bgmusic.mp3" id="bgmusic" autoplay="autoplay"></audio>-->
    </div>
    <!-- 如果需要导航按钮 -->
    <!--<div class="swiper-button-prev"></div>-->
    <!--<div class="swiper-button-next"></div>-->

    <!-- 如果需要滚动条 -->
    <!--<div class="swiper-scrollbar"></div>-->
</div>


<script>

    $(document).ready(function () {
        var offset = 0,offset1=0,offset2=0;
        var inScolling = 0;
        var threshold_bottom = -$("#foodList").height()+$("#foodListWrapper").height(),
            threshold_bottom2 = -$("#orderDetails").height()+$("#orderDetailWrapper").height();
        var threshold_top = 0;
        var mapIndex = 1;
        var menuIndex = 2;

        var mainSwiper = new Swiper ('#main', {
            direction: 'vertical',
//            shortSwipes:false,//短滑动
            longSwipes: false,//支持长慢滑动
//            longSwipesRatio : 0.5,//支持长滑动的情况下，滑动至少百分之多少长度会触发翻页 0.5-0.1 默认0.5
            longSwipesMs : 300,//滑动操作持续多长时间算常翻页
//            touchRatio:1,//手指滑动和屏幕真是移动的比率。默认1：1  可以0.5:1 或者 -0.5:1--即反向
            // 如果需要分页器
            pagination: '.swiper-pagination',
            paginationType : 'custom',
            initialSlide :2,

            paginationCustomRender: function (swiper, current, total) {
                var scaleX = current / total,scaleY = 1;
                $("#progressCustom").transform('translate3d(0,0,0) scaleX(' + scaleX + ') scaleY(' + scaleY + ')').transition(300);
                $("#currentFraction").text(current);
                $("#totalFraction").text(total);
            },

            onInit: function(swiper){ //Swiper2.x的初始化是onFirstInit
                swiperAnimateCache(swiper); //隐藏动画元素
                swiperAnimate(swiper); //初始化完成开始动画
            },
            onSlideChangeEnd: function(swiper){
                swiperAnimate(swiper); //每个slide切换结束时也运行当前slide动画
//                if(swiper.activeIndex==1){
//                    swiper.lockSwipes();
//                }
                if(swiper.activeIndex==mapIndex||swiper.activeIndex==menuIndex){
                    swiper.params.followFinger = false;
                    if(swiper.activeIndex==mapIndex){
                        initMap();
                    }
                }else{
                    swiper.params.followFinger = true;
                }
            },
            onTouchMove: function(swiper, event){
                if(swiper.activeIndex==menuIndex){
                    if($(event.target).closest("#foodListWrapper").length>0){
                        inScolling=1;
                        $("#foodList").transform('translate3d(0px, ' + (offset+swiper.touches.diff) + 'px, 0px)');
                    }else if($(event.target).closest("#orderDetailWrapper").length>0){
                        inScolling=2;
                        $("#orderDetails").transform('translate3d(0px, ' + (offset1+swiper.touches.diff) + 'px, 0px)');
                    }
                }
            },
            onTouchEnd : function(swiper,event){
                if(swiper.activeIndex==menuIndex){
                    if(inScolling==1){

                        if(threshold_bottom>0){
                            //内容少于包裹div
                            offset=threshold_top;
                            $("#foodList").transform('translate3d(0px,'+offset+'px, 0px)');
                        }else{
                            offset+=swiper.touches.diff;
                            if(offset>threshold_top){
                                offset=threshold_top;
                                $("#foodList").transform('translate3d(0px,'+offset+'px, 0px)');
                            }else if(offset<threshold_bottom){
                                offset = threshold_bottom;
                                $("#foodList").transform('translate3d(0px, ' + offset + 'px, 0px)');
                            }
                        }
                    }else if(inScolling==2){
                        if(threshold_bottom2>0){
                            //内容少于包裹div
                            offset1=threshold_top;
                            $("#orderDetails").transform('translate3d(0px,'+offset+'px, 0px)');
                        }else {
                            offset1 += swiper.touches.diff;
                            if (offset1 > threshold_top) {
                                offset1 = threshold_top;
                                $("#orderDetails").transform('translate3d(0px,' + offset1 + 'px, 0px)');
                            } else if (offset1 < threshold_bottom2) {
                                offset1 = threshold_bottom2;
                                $("#orderDetails").transform('translate3d(0px, ' + offset1 + 'px, 0px)');
                            }
                        }
                    }
                    inScolling==0;
                }
            }


        });
        var menuSwiper = new Swiper ('#menu',{
            initialSlide :1,
        });
        menuSwiper.lockSwipes();
        //music
        var playing = false;
        $('#music').click(function(){
            if(playing=='on'){
                $(this).removeClass("rotating").children("audio").get(0).pause();
                playing = 'off';
            }else{
                $(this).addClass("rotating").children("audio").get(0).play();
                playing = 'on';
            }
        });

        //slide2 baidumap
//        $("#map").height($("#map").width());
        var map_center = $('#map').height()/2-35;
        var mapInitialed = false;
        function initMap(){
            var lont=0.0,hont=0.0;
            var noPont=false;
            lont=111.73225;
            hont=40.826618;
            var mappoint = new BMap.Point(lont, hont)
            var map = new BMap.Map("map");
            map.centerAndZoom(mappoint, 14);
//            map.addControl(new BMap.ZoomControl());
            map.addControl(new BMap.NavigationControl({type: BMAP_NAVIGATION_CONTROL_SMALL,offset: new BMap.Size(5, map_center)}));
            map.panTo(136,128);
            if(!noPont){
                var marker = new BMap.Marker(mappoint);// 创建标注
                map.addOverlay(marker);
                var infoWindow1 = new BMap.InfoWindow("&#28180;&#27665;&#26032;&#26449;&#23637;&#19996;&#36335;");
                marker.addEventListener("click", function(){this.openInfoWindow(infoWindow1);});
            }
        }



        //menu
        var foodItems = {};
//        var orderItems = {};
        var total = {price:0,quantity:0};
        function initMenu(){
            //foodItems[id].handler 缓存同一菜品再dom出现多次的情况，如果能保证不重复，这里可以去掉handler以作优化

            $('#category').on('click.zui','li',function(index){
                $(this).addClass('selected').siblings("li").removeClass('selected');
                $('#foodList').children('.food-list-item').eq($(this).index('li')).show().siblings('li').hide();
                changeFoodContentHeight();
            });


            $('#foodList').find('.food-item').each(function(index){
                var id = $(this).attr('name');
                if(!id&&id.trim()=='') id=index;
                if($.isEmptyObject(foodItems[id])){
                    foodItems[id] = {$Quantityhandlers:new Array()};
                    var price,quantity
                    $(this).children('li').each(function(){
                       switch ($(this).attr('class')){
                           case 'food-name':
                               foodItems[id].foodname = $(this).html();
                               break;
                           case 'food-price':
                                 price = $(this).children('span').html().trim();
                                 price = price!=''?parseFloat(price):0.0;
                                 foodItems[id].price = price;
                               break;
                           case 'food-quantity':
                                quantity = $(this).children('span.num').html().trim();
                                quantity = quantity!=''?parseInt(quantity):0;
                                foodItems[id].quantity = quantity;
                                foodItems[id].$Quantityhandlers.push($(this));
                               break;
                       }

                    });
                }else{
                    foodItems[id].$Quantityhandlers.push($(this).children('li.food-quantity'));
                }
            });

            //后续遍历元素，加入handler
            $.each(foodItems,function(key,val){
                if(val.quantity==0){
                    //数量为0，隐藏减号和数量
                   $.each(val.$Quantityhandlers,function(index, item){
                       item.children('span.add,span.minus').hide();
                   });
                }else{
                    total.price+=val.quantity*val.price;
                    total.quantity+=val.quantity;
                }
            });

            //初始化动态元素显示
            buildOrderbyFoodItem();
            changeTotalDisplay();

            //+事件处理
            $('#foodListWrapper').on('click.zui','span.plus',function(){
               plusQuantity($(this).parentsUntil('.food-list-item','[name]'));
            });

            //-事件处理
            $('#foodList').on('click.zui','span.minus',function(){
                minusQuantity($(this).parentsUntil('.food-list-item','[name]'));
            });


            //注册我点好了OK btn
            $('#OK').click(function(){
                buildOrderbyFoodItem();
                menuSwiper.unlockSwipes();
                menuSwiper.slideNext();
                menuSwiper.lockSwipes();
            });

   /**____________order*************************/
            $("#orderDetailList").on('click.zui','span.cancel',function(){
//                for food-item-list
                var $orderItem = $(this).parent();
                clearQuantity($orderItem);
//                for order-list
                $orderItem.remove();
            });

            $('#back,#goOn').click(function(){
                menuSwiper.unlockSwipes();
                menuSwiper.slidePrev();
                menuSwiper.lockSwipes();
            });

            $('#clearAll').click(function(){
                $("#orderDetailList").children("li").each(function(){
                    clearQuantity($(this));
                }).remove();
            });

            $('#orderSubmit').click(function(){
                hideDetailForm();
            });
        };

        function plusQuantity($foodItem){
            var index = $foodItem.attr('name');
            total.price+=foodItems[index].price;
            total.quantity++;
            changeQuantityDisplay(index,++foodItems[index].quantity,'plus');
        }

        function minusQuantity($foodItem){
            var index = $foodItem.attr('name');
            total.price-=foodItems[index].price;
            total.quantity--;
            changeQuantityDisplay(index,--foodItems[index].quantity,'minus');
        }

        function clearQuantity($foodItem){
            var index = $foodItem.attr('name');
            total.price -= foodItems[index].quantity*foodItems[index].price;
            changeQuantityDisplay(index,0,'clear');
        }

        function changeQuantityDisplay(index,num,op){
            $.each(foodItems[index].$Quantityhandlers,function(){
                if(!op){
                    if(num==1&&op=='plus'){
                        $(this).children('span.minus,span.num').show();
                    }else if(op=='clear'||(num==0&&op=='minus')){
                        $(this).children('span.minus,span.num').hide();
                    }
                }else{
                    if(num>0){
                         $(this).children('span.minus,span.num').show();
                    }else{
                         $(this).children('span.minus,span.num').hide();
                    }
                }
                $(this).children('span.num').html(num)
            });
            changeTotalDisplay();
        }

        function changeTotalDisplay(){
            $("span.total-price","#menu").html(total.price+" 元");
            $("span.total-quantity","#menu").html(total.quantity+" 份");
        }

        function buildOrderbyFoodItem(){
//            orderItems = {};
            var html = '';
            $.each(foodItems,function(key,val){
                if(val.quantity>0){
//                    orderItems[key]={
//                        foodname : val.foodname,
//                        price : val.price,
//                        quantity : val.quantity,
//                    };
                    html+='<li name="'+key+'"><span class="food-name">'+val.foodname+'</span><span class="cancel"></span><span class="food-quantity">'+val.price+'元</span><span class="food-price">'+val.quantity+'份</span></li>';
                }
            });
            if(html!=''){
                $("#orderDetailList").html(html);
            }
        }

        function hideDetailForm(){
            $("#orderDetailForm").hide();
            $("#orderDetailList").find('span.cancel').hide();
            changeOrderContentHeight();
        }

        function changeFoodContentHeight(){
            threshold_bottom = -$("#foodList").height()+$("#foodListWrapper").height();
            $("#foodList").transform('translate3d(0px,0px, 0px)');
        }

        function changeOrderContentHeight() {
            threshold_bottom2 = -$("#orderDetails").height()+$("#orderDetailWrapper").height();
            $("#orderDetails").transform('translate3d(0px,0px, 0px)');
        }

        /**
         * 这里是动态更改orderItems，点返回批量而更新到foodItems，然后再调整foodlist显示
         * */
        function synchronizeFoodByOrderItems(){

        }

        function goToOrderView(){

        }

        function backToMenuView(){

        }

        initMenu();





//        $("#content").on('touchmove',function(e){
//            alert("sdf");
//        })
    })

</script>
</body>
</html>